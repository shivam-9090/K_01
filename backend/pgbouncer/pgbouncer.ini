[databases]
; Database connections
; Format: dbname = host=hostname port=port dbname=dbname
auth_db = host=postgres port=5432 dbname=auth_db

[pgbouncer]
; Connection pooling mode
; - session: One connection per client session (most compatible, least efficient)
; - transaction: One connection per transaction (RECOMMENDED - Best balance)
; - statement: One connection per statement (most efficient, least compatible)
pool_mode = transaction

; Listen settings
listen_addr = 0.0.0.0
listen_port = 6432

; Authentication
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

; Administrator settings
admin_users = authuser
stats_users = authuser

; Connection limits
; max_client_conn: Maximum number of client connections (application â†’ PgBouncer)
; default_pool_size: Normal pool size per user/database pair
; min_pool_size: Minimum pool size (kept alive)
; reserve_pool_size: Additional connections for high load
; max_db_connections: Maximum connections to PostgreSQL (total across all pools)
max_client_conn = 1000
default_pool_size = 25
min_pool_size = 10
reserve_pool_size = 5
max_db_connections = 100

; Connection timeouts (in seconds)
; server_idle_timeout: Close server connection if idle for this long
; server_lifetime: Close server connection after this time (connection refresh)
; server_connect_timeout: Timeout for connecting to PostgreSQL
; query_timeout: Maximum query execution time (0 = disabled, handled by PostgreSQL)
server_idle_timeout = 600
server_lifetime = 3600
server_connect_timeout = 15
query_timeout = 0

; Client timeouts
client_idle_timeout = 0
client_login_timeout = 60

; DNS
dns_max_ttl = 15
dns_nxdomain_ttl = 15
dns_zone_check_period = 0

; Logging
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1
log_stats = 1
stats_period = 60

; Prepared statements (transaction mode limitation)
; In transaction mode, prepared statements are NOT supported across connections
; Set max_prepared_statements = 0 to avoid issues
max_prepared_statements = 0

; Performance tuning
pkt_buf = 8192
sbuf_loopcnt = 5
so_reuseport = 1

; TLS/SSL (disabled for now, can be enabled later)
; client_tls_sslmode = disable
; server_tls_sslmode = disable

; Dangerous timeouts (commented out for safety)
; server_reset_query = DISCARD ALL
; server_check_delay = 30
; server_check_query = select 1
; server_fast_close = 0

; Application name passthrough
application_name_add_host = 1

; Ignore startup parameters (useful for compatibility)
ignore_startup_parameters = extra_float_digits

; Verbose logging (disable in production)
verbose = 0

; Syslog (disabled, use Docker logs)
syslog = 0

; Console access
unix_socket_dir = /tmp
unix_socket_mode = 0777

; Autorestart
autodb_idle_timeout = 3600

; Kill server connections when pgbouncer is killed
server_round_robin = 0
server_reset_query_always = 0

; Performance monitoring
track_extra_parameters = IntervalStyle
